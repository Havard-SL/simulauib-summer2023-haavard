\subsection{Initial definitions and results}

\begin{definition}
    Let \( n \in \Nb \), then \( \Ab(n) = \set{ \text{All Abelian Groups over the elements } [n]} \).
\end{definition}

\begin{theorem} \label{thm:abelian-conjugacy}
    Let \( H \in \Ab(n) \), and let \( \phi \in \Sym(n) \).

    Let \( S = \tuple{[n], +_S} \) be a set over \( [n] \) with a binary operation \( +_S \) defined by
    \begin{equation} \label{eq:abelian-conjugacy}
        a +_S b = \phi(\phi^{-1}(a) +_H \phi^{-1}(b))
    \end{equation}
    
    Then \( S \in \Ab(n) \).
\end{theorem}
\begin{proof}
    Let \( e \in H \) be the identity element.
    
    Need to check every abelian group property:

    Associativity:
    \begin{align*}
        (a +_S b) +_S c &= \phi(\phi^{-1}(a +_S b) +_H \phi^{-1}(c)) \\
        &= \phi(\phi^{-1} \circ \phi(\phi^{-1}(a) +_H \phi^{-1}(b)) +_H \phi^{-1}(c)) \\
        &= \phi((\phi^{-1}(a) +_H \phi^{-1}(b)) +_H \phi^{-1}(c)) \\
        &= \phi(\phi^{-1}(a) +_H (\phi^{-1}(b) +_H \phi^{-1}(c))) \\
        &= \phi(\phi^{-1}(a) +_H \phi^{-1} \circ \phi(\phi^{-1}(b) +_H \phi^{-1}(c))) \\
        &= \phi(\phi^{-1}(a) +_H \phi^{-1}(b +_S c)) \\
        &= a +_S (b +_S c)
    \end{align*}

    Identity element:

    Let \( \tilde{e} = \phi(e) \). Want to show that \( \tilde{e} \) is the identity element.

    \begin{align*}
        a +_S \tilde{e} &= \phi(\phi^{-1}(a) +_H \phi^{-1}(\tilde{e})) \\
        &= \phi(\phi^{-1}(a) +_H \phi^{-1} \circ \phi(e)) \\
        &= \phi(\phi^{-1}(a) +_H e) \\
        &= \phi \circ \phi^{-1}(a) \\
        &= a
    \end{align*}
    And similarly on the left side.

    Inverse element:

    Let \( \tilde{a} = \phi(-\phi^{-1}(a)) \). Want to show that \( \tilde{a} \) is the inverse of \( a \).

    \begin{align*}
        a +_S \tilde{a} &= \phi(\phi^{-1}(a) +_H \phi^{-1}(\tilde{a})) \\
        &= \phi(\phi^{-1}(a) +_H \phi^{-1} \circ \phi(-\phi^{-1}(a))) \\
        &= \phi(\phi^{-1}(a) -_H \phi^{-1}(a)) \\
        &= \phi(e) \\
        &= \tilde{e}
    \end{align*}
    And similarly on the left side.

    Commutative:

    \begin{align*}
        a +_S b &= \phi(\phi^{-1}(a) +_H \phi^{-1}(b)) \\
        &= \phi(\phi^{-1}(b) +_H \phi^{-1}(a)) \\
        &= b +_S a
    \end{align*}
\end{proof}

\begin{remark}
    The equation in \autoref{eq:abelian-conjugacy} is equivalent to:
    \[
        a +_H b = \phi^{-1}(\phi(a) +_S \phi(b)).
    \]
\end{remark}

\begin{definition} \label{def:abelian-conjugacy}
    Let \( H \in \Ab(n) \), and let \( \phi \in \Sym(n) \).

    Then the \emph{conjugacy of \( H \) with respect to \( \phi \)} is the abelian group \( S \) as defined in \autoref{thm:abelian-conjugacy}. And it is denoted by \( \phi(H) \).
\end{definition}

\begin{theorem} \label{thm:conjugacy-isomorphism}
    Let \( H \in \Ab(n) \) and let \( \phi \in \Sym(n) \).

    Then \( \phi \) is an isomorphism from \( H \) to \( \phi(H) \).
\end{theorem}
\begin{proof}
    Look at
    \[
        \phi(a +_H b) = \phi(\phi^{-1}(\phi(a) +_{\phi(H)} \phi(b))) = \phi(a) +_{\phi(H)} \phi(b)
    \]
    Which is the definition of a homomorphism. And since \( \phi \) is a bijection, it is therefore an isomorphism.
\end{proof}

\begin{remark}
    For \( H \in Ab(n) \), then the set of conjugacies of \( H \), i.e. 
    \[
        \set{\phi(H) : \phi \in \Sym(n)}
    \]
    is exactly the isomorphism class of \( H \).
\end{remark}

\begin{theorem} \label{thm:conjugacy-automorphism}
    Let \( \phi: H \to S \) be an isomorphism.

    Then \( \lambda \in \Aut(H) \iff \phi \circ \lambda \circ \phi^{-1} \in \Aut(S) \).
\end{theorem}
\begin{proof}
    Show first \( \Rightarrow \):

    Let \( \lambda \in Aut(H) \). Then
    \begin{align*}
        \phi \circ \lambda \circ \phi^{-1} (a +_S b) &= \phi \circ \lambda(\phi^{-1}(a) +_H \phi^{-1}(b)) \\
        &= \phi(\lambda \circ \phi^{-1}(a) +_H \lambda \circ \phi^{-1}(b)) \\
        &= \phi \circ \lambda \circ \phi^{-1}(a) +_S \phi \circ \lambda \circ \phi^{-1}(b) \\
    \end{align*}
    Which is the definition of \( \phi \circ \lambda \circ \phi^{-1} \in \Aut(S) \)

    Show then \( \Leftarrow \):

    Let \( \phi \circ \lambda \circ \phi^{-1} \in \Aut(S) \), and let \( \tilde{a} = \phi(a) \). Then
    \begin{align*}
        \phi \circ \lambda \circ \phi^{-1} (\tilde{a} +_S \tilde{b}) &= \phi \circ \lambda \circ \phi^{-1}(\tilde{a}) +_S \phi \circ \lambda \circ \phi^{-1}(\tilde{b}) \\
        &\Updownarrow \\
        \phi^{-1} \circ \phi \circ \lambda \circ \phi^{-1} (\tilde{a} +_S \tilde{b}) &= \phi^{-1}(\phi \circ \lambda \circ \phi^{-1}(\tilde{a}) +_S \phi \circ \lambda \circ \phi^{-1}(\tilde{b})) \\
        \lambda \circ \phi^{-1} (\tilde{a} +_S \tilde{b}) &= \phi^{-1} \circ \phi \circ \lambda \circ \phi^{-1} (\tilde{a}) +_H \phi^{-1} \circ \phi \circ \lambda \circ \phi^{-1} (\tilde{b}) \\
        \lambda(\phi^{-1}(\tilde{a}) +_H \phi^{-1}(\tilde{b})) &= \lambda \circ \phi^{-1} (\tilde{a}) +_H \lambda \circ \phi^{-1} (\tilde{b}) \\
        \lambda(\phi^{-1}(\phi(a))) +_H \phi^{-1}(\phi(b)) &= \lambda \circ \phi^{-1} (\phi(a)) +_H \lambda \circ \phi^{-1} (\phi(b)) \\
        \lambda(a +_H b) &= \lambda(a) +_H \lambda(b) \qedhere
    \end{align*}
\end{proof}

\begin{remark}
    From \autoref{thm:conjugacy-isomorphism} and \autoref{thm:conjugacy-automorphism} one has that taking any Abelian group \( G \) over \( [n] \) with identity element \( e \in [n] \), and setting \( \phi = (0, e) \), one gets that any automorphism over \( G \) can be ``transformed'' to an automorphism over \( (i, 0)(G) \) where \( 0 \) is the identity, and vice versa. Therefore one only need to look at the automorphisms of abelian groups where \( 0 \) is a fixed identity to look for classifications of permutation as automorphisms.
\end{remark}

\begin{definition}
    Let \( \Ab_0(n) \) denote the subset of \( \Ab(n) \) where \( 0 \) is the identity of the abelian groups.
\end{definition}

\begin{theorem}
    \( \frac{\#\Ab(n)}{\#\Ab_0(n)} = n \)
\end{theorem}
\begin{proof}
    In order to prove this, we need to add a temporary definition:

    Let \( \Ab_i(n) \) denote the subset of \( \Ab(n) \) where \( i \in [n] \) is the identity element.

    Then we have to prove three different lemmas:

    First lemma: \( \Ab_i(n) \cap \Ab_j(n) = \emptyset \) for \( i \neq j \).

    Proof of first lemma: Assume \( \Ab_i(n) \cap \Ab_j(n) \neq \emptyset \). Then there exists an abelian group \( G \in \Ab_i(n) \cap \Ab_j(n) \) that has both \( i \) and \( j \) as an identity element. But then \( i = i *_G j = j \), which is a contradiction, and \( \Ab_i(n) \cap \Ab_j(n) = \emptyset \), since the identity must be unique.

    Second lemma: \( \Ab(n) = \cup_{i=0}^{n-1} \Ab_i(n) \)

    Proof of second lemma: First show \( \subseteq \): Let \( G \in \Ab(n) \). Then, by definition, \( G \) has an identity element, let's say \( e \in [n] \). But then \( G \in \Ab_e(n) \). Therefore \( \Ab(n) \subseteq \cup_{i=0}^{n-1} \Ab_i(n) \).

    Then show \( \supseteq \): Every \( \Ab_j(n) \subseteq \Ab(n) \) by definition. Therefore it follows that \( \Ab(n) \supseteq \cup_{i=0}^{n-1} \Ab_i(n) \).

    Third lemma: \( \#\Ab_i(n) = \#\Ab_j(n) \) for all \( i, j \in [n] \).

    Proof of third lemma: Let \( \phi = (i, j) \). Then one can define a map:
    \begin{align*}
        \varphi: \Ab_i(n) &\to \Ab_j(n) \\
        G &\mapsto \phi(G)
    \end{align*}
    Want to show that this map is a bijection, and therefore preserves the cardinality of the sets.

    First, let's show that \( \varphi \) is injective: Let \( G, H \in \Ab_i(n) \) and let \( \tilde{a} = \phi(a) \) and \( \tilde{b} = \phi(b) \).

    Then
    \begin{align*}
        \varphi(G) &= \varphi(H) \\
        \phi(G) &= \phi(H) \\
        &\Downarrow \\
        \tilde{a} +_{\phi(G)} \tilde{b} &= \tilde{a} +_{\phi(H)} \tilde{b} \\
        \phi(\phi^{-1}(\tilde{a}) +_G \phi^{-1}(\tilde{b})) &= \phi(\phi^{-1}(\tilde{a}) +_H \phi^{-1}(\tilde{b})) \\
        &\Updownarrow \\
        \phi^{-1}(\phi(\phi^{-1}(\tilde{a}) +_G \phi^{-1}(\tilde{b}))) &= \phi^{-1}(\phi(\phi^{-1}(\tilde{a}) +_H \phi^{-1}(\tilde{b}))) \\
        \phi^{-1}(\tilde{a}) +_G \phi^{-1}(\tilde{b}) &= \phi^{-1}(\tilde{a}) +_H \phi^{-1}(\tilde{b}) \\
        a +_G b &= a +_H b
    \end{align*}
    So \( G \) and \( H \) are groups with the same group operation over the exact same set. They are therefore equal, i.e. \( G = H \).

    Secondly, lets show that \( \varphi \) is surjective: Let \( K \in \Ab_j(n) \). Then want to show that \( \varphi(\phi^{-1}(K)) = \phi(\phi^{-1}(K)) = K \).

    First, note that \( a +_{\phi^{-1}(K)} b = \phi^{-1}(\phi(a) +_K \phi(b)) \). Then
    \begin{align*}
        a +_{\phi(\phi^{-1}(K))} b &= \phi(\phi^{-1}(a) +_{\phi^{-1}(K)} \phi^{-1}(b)) \\
        &= \phi(\phi^{-1}(\phi(\phi^{-1}(a)) +_K \phi(\phi^{-1}(b)) )) \\
        &= \phi(\phi^{-1}(a)) +_K \phi(\phi^{-1}(b)) \\
        &= a +_K b
    \end{align*}
    So \( K \) and \( \phi(\phi^{-1}(K)) \) are groups with the same group operation over the exact same set. They are therefore equal, i.e. \( K = \phi(\phi^{-1}(K)) \).

    So for the proof of the theorem: The first and the second lemma gives that \( \Ab(n) \) is a disjoint union of \( \set{\Ab_i(n) : i \in [n]} \). Therefore \( \#\Ab(n) = \sum_{i=0}^{n-1} \#\Ab_i(n) \). But the third lemma says that \( \Ab_i(n) = \Ab_0(n) \) for all \( i \). Therefore \( \#\Ab(n) = \sum_{i=0}^{n-1} \#\Ab_0(n) = n\#\Ab_0(n) \) which implies \( \frac{\#\Ab(n)}{\#\Ab_0(n)} = n \).
\end{proof}

\begin{theorem} \label{thm:ab-latin-square-property}
    Let \( H \in \Ab(n) \).

    Then for every \( a \in H \), the map \( \varphi_a: x \mapsto x +_H a \) is a bijection.
\end{theorem}
\begin{proof}
    Assume there exists an \( a \in H \) such that \( \varphi_a \) is not a bijection.
    
    Since \( \varphi_a: H \to H \), and \( H \) has finite cardinality. Then \( \varphi_a \) is not injective. This implies that there exist to values \( x \neq y \) such that \( x +_H a = y +_H a \). But using the latter equation and adding \( -a \) to both sides, one gets that \( x = y \) which is a contradiction.
\end{proof}

\begin{remark}
    The property in \autoref{thm:ab-latin-square-property} is the \emph{latin square property}, which will be further studied later.
\end{remark}

\subsection{Results and counterexamples}

\begin{theorem}
    Let \( S \) be a set with a closed binary operation \( *_S \) that is
    \begin{itemize}
        \item associative, and
        \item commutative, and
        \item where for any \( a \in S \), the map \( x \mapsto x *_S a \) is a bijection,
    \end{itemize}
    has an identity element. And is therefore an Abelian group.
\end{theorem}
\begin{proof}[Early proof]
    Let \( a \) be any element in the group. Since \( a + x \) is a bijection, there exist a \( y \) such that \( a + y = a \). Want to prove that this \( y \) is in fact an identity element for the binary operation.

    Assume \( b + y = z\) for some \( z \). adding \( a \) to both sides gives an equivalent equation: \( a + (b + y) = a + z \). Using associativity, this becomes: \( (a + b) + y = a + z \). Then from commutativity one gets \( (b + a) + y = a + z \). Using associativity again, one gets: \( b + (a + x) = a + z\). But since \( a + y = a \) by assumption, this reduces to: \( b + a = a + z \). But since the operation \( a + x\) is a bijection, it is then injective, and hence \( z = b \), which implies \( b + y = b\). Since the choice of \( b \) was arbitrary, \( y \) is the identity element.
\end{proof}
\begin{proof}[Late proof]
    Follows from \autoref{thm:associative-quasigroup-group}.
\end{proof}

\begin{remark}
    For every \( \phi \in \Sym(n) \), and for every \( H \in \Ab(n) \), if \( a = b +_H b \), then \( \phi(a) = \phi(b) +_{\phi(H)} \phi(b) \). This implies that any element on the diagonal of the group operation table stays on the diagonal of the group operation table, but permuted.

    For example, consider the case when \( \phi(0) = 0 \), then one has that the conjugate must have the exact same amount of zeros on the diagonal.
\end{remark}

\begin{counterexample}
    Let \( \phi \in \Sym(n) \) with \( \phi(0) = 0 \).
    
    Then there \emph{does not necessarily} exist a \( H \in \Ab_0(n) \) such that \( \phi \in \Aut(H) \).
\end{counterexample}
\begin{proof}[Special case proof]
    Let \( \phi = (3, 4) \), there want to show that there are no groups \( H \) in \( \Ab_0(5) \) where \( \phi \in \Aut(H) \) with a proof by contradiction.

    Assume \( \phi \) is an automorphism for \( H \in G_0(5) \).

    Then \( \phi(1 +_H 1) = \phi(1) +_H \phi(1) = 1 +_H 1 \), and \( \phi(2 +_H 2) = \phi(2) +_H \phi(2) \), and \( \phi(1 +_H 2) = \phi(1) +_H \phi(2) = 1 +_H 2 \). This means that \( 1 +_H 1, 2 +_H 2, 1 +_H 2 \in \{0, 1, 2\} \), since they are fixed points of the map \( \phi \). And the set \( \{ 0, 1, 2 \} \) is therefore closed under the group operation.

    Furthermore, since \( 1 +_H 2 \) can not be \( 1 \) or \( 2 \), since that would imply that either \( 1 \) or \( 2 \) is an identity, then \( 1 +_H 2 = 0 \), and the set \( \{ 0, 1, 2 \} \) is therefore a subgroup of \( H \), since every element in \( \set{0, 1, 2} \) has an inverse. But \( H \) has order \( 5 \), which \( 3 \) does not divide which contradicts Lagrange's theorem, and therefore \( \phi \) can not be an automorphism.
\end{proof}
\begin{proof}[General case proof]
    Let \( n \geq 5 \), and let \( \phi \in \Sym(n) \) with \( \phi = (n-2, n-1) \). Want to do a proof by contradiction to show that there are no groups \( H \in \Ab_0(n) \) such that \( \phi \in \Aut(H) \).

    Assume \( \phi \in \Aut(H) \).

    Then for \( i, j \in [n-3] \) one has that \( \phi(i +_H j) = \phi(i) +_H \phi(j) = i +_H j \). So \( i +_H j \in [n - 3] \) since it is a fixed point of \( \phi \). But then one has that the top left \( (n - 2) \times (n - 2) \) square of the group operation table of \( H \) only contains elements in \( [n-3] \). One has by the latin square property (\autoref{thm:ab-latin-square-property}) that the remaining two elements, \( n - 2 \) and \( n - 1 \) has to appear once for every row of the top right rectangle with the shape \( (n - 2) \times (2) \), since the elements doesn't appear in any of the rows in the top left \( (n - 2) \times (n - 2) \) square of the group operation table. However, since \( n \geq 5 \), the top right rectangle has a height of at least \( 3 \), which is greater than it's width. One would therefore have one column where the same element would appear at least twice, which also breaks the latin square property. Therefore \( \phi \not\in \Aut(H) \).
\end{proof}

\begin{counterexample} \label{counterexample:construction-early-ab-destroy}
    Let \( \phi \in \Sym(n) \).

    Then there \emph{does not neccesarily} exist a \( H \in Ab(n) \) with \( a \in H \) such that the map  \( x \mapsto  x +_H a \) is equal to \( \phi \).
\end{counterexample}
\begin{proof}[Simple proof]
    Let \( \phi(0) = 0 \), but not be equal to the identity map. Then if \( x \mapsto x +_H a = a +_H x \) is equal to \( \phi \), it would imply that there is a row in the group operation table that is  \( \tuple{0, \phi(1), \phi(2), \dots, \phi(n-1)} \). However since this is not the identity row, it means there must be another row in the group operation table that is \( \tuple{0, 1, 2, \dots, n-1} \). But then one has two rows that start with \( 0 \), which breaks the latin square property of \( H \).
\end{proof}
\begin{proof}[Later proof]
    This is implied by \autoref{counterexample:ab-aaut}.
\end{proof}

\begin{definition} \label{def:abelian-aaut}
    For \( H \in \Ab(n) \),

    then let \( \AAut(H) := \set{\phi(\_) +_H v : \phi \in \Aut(H) \land v \in H} \).
\end{definition}

\begin{counterexample} \label{counterexample:ab-aaut}
    Let \( \phi \in \Sym(n) \).

    Then there \emph{does not necessarily} exist an \( H \in \Ab(n) \) such that \( \phi \in \AAut(H) \).
\end{counterexample}
\begin{proof} % Proof requires commutativity. If it was non-commutative, would it be possible?
    Let \( \phi = (3, 4) \). Want to show that \( \phi \) is not an affine automorphism for any group \( H \) in \( \Ab(5) \).

    We will do a proof by contradiction by assuming that \( \phi \in \AAut(H) \), and getting a contradiction. We have to look at two different cases to prove this. First when the identity is \( 0, 1, \) or  \( 2 \). And then secondly when the identity is either \( 3 \) or \( 4 \).

    Assume that \( \phi \in \AAut(H) \). Denote the identity of \( H \) by ``\( e \)''. Furthermore let \( \alpha \in \Aut(H) \) and \( \tilde{v} \in H \) be the elements such that \( \phi(\_) = \alpha(\_) +_H \tilde{v} \).

    Let \( v = -\tilde{v} \).

    This gives that \( \alpha(\_) = \phi(\_) +_H (-\tilde{v}) = \phi(\_) +_H v \).

    Then one has that
    \[
        e = \alpha(e) = \phi(e) +_H v.
    \]
    This gives us that \( v = -\phi(e) \).

    Case 1: Assume that \( e \in \{ 0, 1, 2 \} \).

    Then one has that \( v = -e = e \). So then \( \phi \in \Aut(H) \) by the assumption. 
    
    This gives us that \( \{0, 1, 2\} \) is a subgroup of \( H \), since for \( a, b \in \{0, 1, 2 \} \) then \( \phi(a +_H b) = \phi(a) +_H \phi(b) = a +_H b \), which makes \( a +_H b \) a fixed-point of \( \phi \), and therefore \( a +_H b \in \{0, 1, 2 \} \). Furthermore \( 0 +_H 1 +_H 2 = e \) since \( e \in \set{0, 1, 2} \), so the identity element can be removed from the sum, and the elements left have to sum to the identity or else there would be two different identities, which is not possible in a group. Therefore every element has it's inverse in \( \{0, 1, 2 \} \). Along with associativity from \( H \), then the set \( \{0, 1, 2 \} \) is a subgroup of order \( 3 \).

    This is \emph{not possible} since every subgroup of \( H \), which has order \( 5 \), must divide it's order by Lagrange's theorem.

    Case 2: Assume that \( e \in \{ 3, 4 \} \). Without loss of generality assume \( e = 3 \).

    Then one has that \( v = -\phi(3) = -4 \). And specifically one has that
    \[
        \alpha(4) = \phi(4) - 4 = 3 -_H 4 = - 4
    \]
    And by the homomorphism property, \( \alpha(-4) = -\alpha(4) = -(-4) = 4 \)

    In general notice that
    \[
        \alpha(i) =
        \begin{cases}
            i -_H, 4 & i \in \{ 0, 1, 2 \} \\
            3, & i = 3 \\
            -4, & i = 4
        \end{cases}
    \]
    This gives the identity: \( \alpha(\alpha(i)) = i \). So \( \alpha \) is it's own inverse, and therefore it must be a composition of zero, one or two disjoint transmutations.

    We further split this up into two cases:

    Case 2.1: Assume \( \alpha \) has a fixed-point besides \( 3 \).

    Then by the fact that \( \alpha \) is the composition of zero, one or two disjoint transmutations, it must be either identity or one transmutation. This implies there is at least one fixed-point among \( \{ 0, 1, 2 \} \). Without loss of generality, assume this fixed element is \( 0 \). Then \( 0 = \alpha(0) = 0 -_H 4 \). But subtracting \( 0 \) on either side, on gets that \( 3 = -4 \), which is not true, since then \( 3 = 4 -_H 4 = 4 +_H 3 = 4 \), which is not true.

    Case 2.2: Assume \( \alpha \) has no fixed-points beside \( 3 \). Without loss of generality, assume \( \alpha = (0, 4)(1, 2) \)

    Then 
    \[ 
        1 +_H 2 = 1 -_H 4 +_H 2 -_H 4 +_H 4 +_H 4 = \alpha(1) + \alpha(2) +_H 4 +_H 4 = 2 +_H 1 +_H 4 +_H 4.
    \]
    But by adding \( -(1 +_H 2) \) to both sides, one gets: \( 4 +_H 4 = 3\). However, this implies \( 4 = -4 = \alpha(4) = 0 \), which is not true.
\end{proof}

\begin{remark} \label{remark:ab-aaut-counterexample-notes}
    The above proof could most likely be rewritten to not depend on commutativity, but I have not looked into the details (``Case 2.2'' may pose some issues). Should work since every group is abelian for \( n = 5 \) by the classification of finite groups. 
    
    But could it be extended to disprove any loops (\autoref{def:loop})? If so, that would be a big result, since it would prove that \autoref{construction:affine-automorphism-quasigroup} is the best general construction for every permutaton.
\end{remark}